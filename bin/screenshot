#!/usr/bin/env bash
# Made by mH (https://github.com/matthmr)

#*****************************************************
# change anything that is followed by "#change this" #
#*****************************************************

# screenshot: generic screenshot dmenu utility
#  - screenshot (prompt for full path)
#  - screenshot-dir (save in <dir>)
#  - screenshot-quick (save in <tmp>)

AS=${0##*/}

DMENU="/home/mh/Source/bin/dmenu" # change this
SCREENSHOT="/mnt/ssd/root/usr/bin/shotgun" # change this
SCREENSHOT_OPTS="" # change this
SCREENSHOT_DIR="/home/mh/Images/Screenshots" # change this
NOTIFY=herbe

OPT_X11_GEOM="/mnt/ssd/root/usr/bin/hacksaw -r" # change this

OPT="\
window root
select
"

function feeddmenu {
	echo -ne "$1" | $DMENU -p "$2"
}

function feedopt {
  [[ -z $1 ]] && exit 1

  case $1 in
    'window root')
      echo '-s';;
    'select')
      echo "-g $($OPT_X11_GEOM)";;
    *)
      exit 1;;
  esac
}

if [[ $AS = 'screenshot-quick' ]]; then
  FILENAME=/tmp/$(/home/mh/Scripts/date/date-join.sh).png
  SCREENSHOT_OPTS='-s'
	#OPT=`feeddmenu "$OPT" "option"`
  #SCREENSHOT_OPTS=$(feedopt "$OPT")
else
  FILENAME=`feeddmenu "" "filename"`
  if [[ -z $FILENAME ]]; then
    exit 1
  else
	  OPT=`feeddmenu "$OPT" "option"`
    SCREENSHOT_OPTS=$(feedopt "$OPT")
  fi
  FILENAME=$FILENAME.png
fi

if [[ $AS = 'screenshot-dir' ]]; then
    FILENAME=$SCREENSHOT_DIR/$FILENAME
fi

$SCREENSHOT $SCREENSHOT_OPTS $FILENAME
$NOTIFY 'Screenshot taken' "Save as $FILENAME"
