#!/usr/bin/sh

_help() {
		notify-send "emacsserver help"
		"\
Usage:       emacsserverx [start|stop|status|restart] \
Description: Starts an emacs server. Similar to \`emacsserver', but with notifications"
}

case $1 in
    '-h'|'--help')
				_help
				exit 1
				;;
esac

_start() {
    {
				[[ -d /run/user/$UID/emacs && -s /run/user/$UID/emacs/emacs.pid ]]
    } && {
				notify-send "emacsserver start" "An emacs server is already running"
				exit 1
    }

    SHELL=/usr/bin/sh \
				EMACS=/usr/bin/emacs \
				EMACSCLIENT=/usr/bin/emacsclient \
				EMACSCLIENT_OPTS="-s /run/user/$UID/emacs/server" \
				/home/mh/Scripts/emacs-wrapper.sh --daemon

		notify-send "emacsserver start" "emacs server started"
}

_stop() {
    {
				[[ -d /run/user/$UID/emacs && -s /run/user/$UID/emacs/emacs.pid ]]
    } || {
				notify-send "emacsserver stop" "no emacs server was found"
				exit 1
    }

    USER=$USER \
				EMACSCLIENT=/usr/bin/emacsclient \
				EMACSCLIENT_OPTS="-s /run/user/$UID/emacs/server" \
				EMACS_TIMEOUT=10 \
				/home/mh/Scripts/emacs-stop.sh

		notify-send "emacsserver stop" "emacs server stopped"
}

_restart() {
    _stop && \
				sleep 5 && \
				_start
}

_status() {
    {
				[[ -d /run/user/$UID/emacs && -s /run/user/$UID/emacs/emacs.pid ]]
    } && {
				notify-send "emacsserver status" "found an emacs server running with pid of $(cat /run/user/$UID/emacs/emacs.pid)"
				exit 0
    } || {
				notify-send "emacsserver staus" "no emacs server was found"
				exit 1
    }
}

case $1 in
    'start')   _start	|| exit $?;;
    'stop')    _stop	|| exit $?;;
    'status')  _status	|| exit $?;;
    'restart') _restart	|| exit $?;;
    *) _help; exit 1;;
esac

exit 0
